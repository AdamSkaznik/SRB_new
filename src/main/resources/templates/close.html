<!--
  ~ Copyright (c) 2023. Adam Skaźnik for SOL PPL Chopin Airport
  ~ All rights reserved.
  -->

<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
	  th:replace="~{fragments/layout::layout(~{::.container})}">
<head>
	<meta charset="utf-8">
</head>
<body>
<div class="container" style="margin-top: 60px">
		<div class="controls">
			<form th:action="@{/saveClose}" th:object="${event}" method="post">
			<div class="panel panel-primary">
				<div class="panel-heading">Zakończenie interwencji</div>
				<div class="panel-body">
					<div class="col-sm">
						<label> Wybierz sposób zakończenia </label>
						<select class="form-control" id="close" required></select>
						<input type="text" id="tempCloseTypeId" hidden>
						<input type="text" id="tempEventIdToClose" hidden>
					</div>
					<br>
					<div class="form-group">
						<div class="panel panel-danger" id="test3">
						<div class="panel-heading"> Dodatkowe informacje - zaznacz jeśli TAK</div>
						<div class="panel-body">
						<div class="custom-control custom-checkbox">
						<input type="checkbox" class="custom-control-input" id="chck1" name="chck1">
						<label class="custom-control-input" for="chck1"> Czy współpracowano ze służbami zewnętrznymi? </label>
						</div>
						<div class="custom-control custom-checkbox">
						<input type="checkbox" class="custom-control-input" id="chck2" name="chck2">
						<label class="custom-control-input" for="chck2"> Czy współpracowano ze służbami medycznymi? </label>
						</div>
						<div class="custom-control custom-checkbox">
							<input type="checkbox" class="custom-control-input" id="chck3" name="chck3">
							<label class="custom-control-input" for="chck3"> Czy użyto SPB? </label>
						</div>
						</div>
						</div>
					</div>
					<div class="form-group" id="sz" style="display: none">
<!--						<label for=""> Zaangażowanie służb zewnętrznych</label>-->
						<div class="form-check form-control">
							<label> Zaangażowanie służb zewnętrznych &nbsp;&nbsp;</label>
							<input class="form-check-label" type="checkbox" name="allInvolved"
								   th:each="in : ${allInvolved}"
								   th:text="'&nbsp' +${in.involvedName} + '&nbsp;&nbsp;&nbsp'"
								   th:value="${in.involvedId}"
								   th:field="*{involvedServices}"
							/>
						</div>
					</div>
				<div class="form-group" id="sm" style="display: none">
					<div class="form-check form-control">
						<label>Zaangażowanie służb medycznych</label>
						<input class="form-check-label" type="checkbox" name="allMedical"
							   th:each="me : ${allMedical}"
							   th:text="'&nbsp' +${me.medicalServicesName} + '&nbsp;&nbsp;&nbsp'"
							   th:value="${me.medicalId}"
							   th:field="*{medicalServices}"
							   />
					</div>
				</div>
					<div class="panel panel-danger" id="spbUse" style="display: none">
						<div class="panel-heading"> Użycie SPB</div>
						<div class="panel-body">
							<div class="form-group">

								<div class="form-check form-control" style="font-weight: bold">
								<label for=""> Użyte ŚPB: &nbsp;&nbsp;</label>
								<input type="checkbox" name="spbs" style="margin-left: 10px"
								   th:each="spb : ${spbs}"
								   th:text="'&nbsp;&nbsp' + ${spb.spbName}"
								   th:value="${spb.spbId}"
								   th:field="*{spbs}"
								/>
								</div>
							</div>
							<div class="col-sm">
								<label for="tempBeforeSpb"> Czynności przed użyciem SPB</label>
								<textarea class="form-control" id="tempBeforeSpb" rows="5" th:field="*{stepsBeforeUseSPB}"></textarea>
							</div>
							<div class="col-sm">
								<label for="tempAfterSpb"> Czynności po użyciu SPB</label>
								<textarea class="form-control" id="tempAfterSpb" rows="5" th:field="*{stepsAfterUseSPB}"></textarea>
							</div>
							<div class="col-sm">
								<label for="tempHealth"> Opis stanu zdrowia</label>
								<textarea class="form-control" id="tempHealth" rows="5" th:field="*{health}"></textarea>
							</div>
						</div>
					</div>
<!--					koniec bloku z użyciem SPB-->
					<div class="col-sm">
						<label for="tempDesc">Dane osoby/osób wobec których przeprowadzano interwencję</label>
						<textarea class="form-control" id="tempPersonDesc" rows="5"></textarea>
					</div>
					<div class="col-sm">
						<label for="tempDesc">Dodatkowe informacje</label>
						<textarea class="form-control" id="tempDesc" rows="5"></textarea>
					</div>
				</div>
			</div>
			<div class="uk-margin uk-align-right">
				<button type="submit" id="save" class="btn btn-primary"><i class="glyphicon glyphicon-ok"> Zapisz</i>
				</button>
			</div>
			</form>
		</div>
</div>
</body>
</html>
<script type="text/javascript">
    $(function () {
        $("#close").select2({
            language: "pl",
            // minimumInputLength: 3,
            placeholder: "Wybierz ...",
            theme: 'bootstrap4',
            selectionCssClass: 'form-control',
            ajax: {
                url: "/api/closeType/search/v1",
                dataType: 'json',
                type: 'GET',
                data: function (params) {
                    console.log(params)
                    return {
                        term: params.term,
                        page: params.page || 1,
                    }
                },
                processResults(data) {
                    console.log(data)
                    return {
                        results: $.map(data, function (item) {
                            return {
                                text: item.closeTypeName,
                                id: item.id,
                            }
                        })
                    }
                }

            }
        })
    });

    $("#close").on('change', function () {
        $("#tempCloseTypeId").val($(this).val());
    });

$(document).ready(function (){
 $('#chck1').change(function (){
     $('#sz').toggle();
 });
 $('#chck2').change(function (){
     $('#sm').toggle();
 });
 $('#chck3').change(function (){
   $('#spbUse').toggle();
 })
});



</script>
